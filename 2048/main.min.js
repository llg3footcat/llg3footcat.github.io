var __reflect=this&&this.__reflect||function(e,t,i){e.__class__=t,i?i.push(t):i=[t],e.__types__=e.__types__?i.concat(e.__types__):i},__extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,i){function s(s){t.call(i,s,e)}if(RES.hasRes(e)){var r=RES.getRes(e);r?s(r):RES.getResAsync(e,s,this)}else RES.getResByUrl(e,s,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var Game=function(e){function t(){var t=e.call(this)||this;if(t.back_tile=null,t.num=null,t.size=4,t.num_array=[],t.gap=10,t.isover=!1,t.score=0,t.best=0,t.level=3,t.goal=2048,t.skinName="resource/skins/game.exml",t.btn_restart.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onclick_restart,t),t.btn_restart1.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onclick_restart1,t),t.btn_restart2.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onclick_restart2,t),t.btn_more.addEventListener(egret.TouchEvent.TOUCH_TAP,t.more,t),egret.MainContext.deviceType!=egret.MainContext.DEVICE_MOBILE){var i=t;document.addEventListener("keydown",function(e){switch(e.keyCode){case 38:i.doMove("up");break;case 39:i.doMove("right");break;case 40:i.doMove("down");break;case 37:i.doMove("left");break;case 87:i.doMove("up");break;case 68:i.doMove("right");break;case 83:i.doMove("down");break;case 65:i.doMove("left")}})}else t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,t.mouseDownHandle,t);t.bg.scale9Grid=new egret.Rectangle(20,20,65,65),t.bg.width=520,t.bg.height=t.bg.width,t.game_bg();for(var s=0;s<Math.pow(t.size,2);s++)t.num_array[s]=0;return t.random_num(),t.random_num(),t.best=Number(egret.localStorage.getItem("best")),t.lb_best.text=t.best.toString(),t}return __extends(t,e),t.prototype.title=function(e){this.lb_title.text=e,this.lb_explain.text="合并数字直到出现"+e,this.goal=e},t.prototype.mouseDownHandle=function(e){this.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.stage_mouseMoveHandler,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.stage_mouseUpHandler,this),this.addEventListener(egret.Event.LEAVE_STAGE,this.stage_mouseUpHandler,this),this.downPoint=this.globalToLocal(e.stageX,e.stageY)},t.prototype.stage_mouseMoveHandler=function(e){this.movePoint||(this.movePoint=new egret.Point),this.movePoint.x=e.stageX,this.movePoint.y=e.stageY,this.needMove||(this.needMove=!0)},t.prototype.stage_mouseUpHandler=function(e){this.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.stage_mouseMoveHandler,this),this.removeEventListener(egret.TouchEvent.TOUCH_END,this.stage_mouseUpHandler,this),this.addEventListener(egret.Event.LEAVE_STAGE,this.stage_mouseUpHandler,this),this.needMove&&(this.updateWhenMouseUp(),this.needMove=!1)},t.prototype.updateWhenMouseUp=function(){var e=this.globalToLocal(this.movePoint.x,this.movePoint.y),t=e.x-this.downPoint.x,i=e.y-this.downPoint.y;0>i&&Math.abs(i)>Math.abs(t)?this.doMove("up"):t>0&&t>Math.abs(i)?this.doMove("right"):i>0&&i>Math.abs(t)?this.doMove("down"):0>t&&Math.abs(t)>Math.abs(i)&&this.doMove("left")},t.prototype.onclick_restart=function(){switch(this.level){case 1:this.title(512);break;case 2:this.title(1024);break;case 3:this.title(2048);break;case 4:this.title(4096);break;case 5:this.title(8192)}for(var e=0,t=this.num_array.length;t>e;e++)if(0!=this.num_array[e]){this.num_array[e]=0;var i=this.gp_num.getChildByName(e.toString());this.gp_num.removeChild(i)}this.score=0,this.lb_score.text=this.score.toString(),this.isover=!1,this.img_over.visible=!1,this.img_failed.visible=!1,this.img_success.visible=!1,this.btn_restart1.visible=!1,this.btn_restart2.visible=!1,this.img_bad.visible=!1,this.img_win.visible=!1,this.btn_more.visible=!1,this.random_num(),this.random_num()},t.prototype.onclick_restart1=function(){this.level>1?(this.level-=1,this.onclick_restart()):this.img_bad.visible=!0},t.prototype.onclick_restart2=function(){this.level<5?(this.level+=1,this.onclick_restart()):this.img_win.visible=!0},t.prototype.game_bg=function(){this.tile_size=(this.gp_tile.width-(this.size+1)*this.gap)/this.size;for(var e=0;e<this.size;e++)for(var t=0;t<this.size;t++)this.back_tile=new Tile,this.back_tile.width=this.back_tile.height=this.tile_size,this.back_tile.x=t*(this.tile_size+this.gap)+this.gap,this.back_tile.y=e*(this.tile_size+this.gap)+this.gap,this.gp_tile.addChild(this.back_tile)},t.prototype.random_num=function(){for(var e=0,t=0,i=this.num_array.length;i>t;t++)0==this.num_array[t]&&(e=1);if(0!=e){for(var s=1;s>0;){var r=Math.round(Math.random()*Math.pow(this.size,2));s=this.num_array[r]}this.num_array[r]=1,this.create_num(r,1)}},t.prototype.create_num=function(e,t){var i=e%this.size,s=Math.floor(e/this.size);this.num=new Num(t),this.num.name=e,this.num.width=this.num.height=this.tile_size,this.num.x=i*(this.tile_size+this.gap)+this.gap,this.num.y=s*(this.tile_size+this.gap)+this.gap,this.gp_num.addChild(this.num)},t.prototype.touch_begin=function(e){},t.prototype.touch_end=function(e){},t.prototype.touch_move=function(e){},t.prototype.doMove=function(e){if(!this.isover){switch(e){case"up":for(var t=4,i=this.num_array.length;i>t;t++)for(var s=t;s>=4;)this.merge(s-4,s),s-=4;break;case"right":for(var t=14;t>=0;t--)for(s=t;s%4!=3;)this.merge(s+1,s),s+=1;break;case"down":for(var t=11;t>=0;t--)for(s=t;11>=s;)this.merge(s+4,s),s+=4;break;case"left":for(var t=1,i=this.num_array.length;i>t;t++)for(s=t;s%4!=0;)this.merge(s-1,s),s-=1}this.random_num(),this.iswin()&&this.gameove(1),this.islose()&&this.gameove(0)}},t.prototype.merge=function(e,t){0!=this.num_array[t]&&this.setTile(e,t)},t.prototype.setTile=function(e,t){if(0!=this.num_array[e]){if(this.num_array[e]==this.num_array[t]){var i=this.gp_num.getChildByName(e);this.gp_num.removeChild(i),this.num_array[e]=this.num_array[e]+1,this.create_num(e,this.num_array[e]);var s=this.gp_num.getChildByName(t);this.gp_num.removeChild(s),this.num_array[t]=0,this.score+=Math.pow(2,this.num_array[e]),this.lb_score.text=this.score.toString(),this.score>this.best&&(this.best=this.score,this.lb_best.text=this.best.toString(),egret.localStorage.setItem("best",this.best.toString()))}}else{this.num_array[e]=this.num_array[t],this.create_num(e,this.num_array[e]),this.num_array[t]=0;var s=this.gp_num.getChildByName(t);this.gp_num.removeChild(s)}},t.prototype.islose=function(){for(var e=0,t=this.num_array.length;t>e;e++){if(0==this.num_array[e])return!1;if(e%4!=3&&this.num_array[e]==this.num_array[e+1])return!1;if(12>e&&this.num_array[e]==this.num_array[e+4])return!1}return!0},t.prototype.iswin=function(){for(var e=0,t=this.num_array.length;t>e;e++)if(Math.pow(2,this.num_array[e])==this.goal)return!0},t.prototype.gameove=function(e){this.isover=!0,this.img_over.visible=!0,this.btn_more.visible=!0,0==e?(this.img_failed.visible=!0,this.btn_restart1.visible=!0):(this.img_success.visible=!0,this.btn_restart2.visible=!0)},t.prototype.more=function(){location.href="http://game.zyyapp.com"},t}(eui.Component);__reflect(Game.prototype,"Game");var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.createView(),t}return __extends(t,e),t.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},t.prototype.setProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var Main=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isThemeLoadEnd=!1,t.isResourceLoadEnd=!1,t}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this);var t=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",t),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},t.prototype.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var t=new eui.Theme("resource/default.thm.json",this.stage);t.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},t.prototype.onThemeLoadComplete=function(){this.isThemeLoadEnd=!0,this.createScene()},t.prototype.onResourceLoadComplete=function(e){"preload"==e.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.isResourceLoadEnd=!0,this.createScene())},t.prototype.createScene=function(){this.isThemeLoadEnd&&this.isResourceLoadEnd&&this.startCreateScene()},t.prototype.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},t.prototype.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},t.prototype.onResourceProgress=function(e){"preload"==e.groupName&&this.loadingView.setProgress(e.itemsLoaded,e.itemsTotal)},t.prototype.startCreateScene=function(){this.addChild(new Game)},t}(eui.UILayer);__reflect(Main.prototype,"Main");var Num=function(e){function t(t){var i=e.call(this)||this;return i.NumType=t,i}return __extends(t,e),Object.defineProperty(t.prototype,"NumType",{get:function(){return this._NumType},set:function(e){this._NumType=e;var t="number_"+e;this.source=RES.getRes(t)},enumerable:!0,configurable:!0}),t}(eui.Image);__reflect(Num.prototype,"Num");var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,i,s){function r(e){t.call(s,e)}function o(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),i.call(s))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),RES.getResByUrl(e,r,this,RES.ResourceItem.TYPE_TEXT)},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var Tile=function(e){function t(){var t=e.call(this)||this,i="backtile";return t.source=RES.getRes(i),t}return __extends(t,e),t}(eui.Image);__reflect(Tile.prototype,"Tile");